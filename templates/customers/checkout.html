{% extends 'quicklink/customers.html' %}
{% load static %}

{% block pagetitle %}Checkout{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/css/intlTelInput.css" integrity="sha512-gxWow8Mo6q6pLa1XH/CcH8JyiSDEtiwJV78E+D+QP0EVasFs8wKXq16G8CLD4CJ2SnonHr4Lm/yY2fSI2+cbmw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/css/intlTelInput.min.css" integrity="sha512-yye/u0ehQsrVrfSd6biT17t39Rg9kNc+vENcCXZuMz2a+LWFGvXUnYuWUW6pbfYj1jcBb/C39UZw2ciQvwDDvg==" crossorigin="anonymous" />
<style>
    .iti__flag {background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/img/flags.png");}

    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .iti__flag {background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/img/flags@2x.png");}
    }
</style>
{% endblock %}

{% block scriptsHead %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/intlTelInput.min.js" integrity="sha512-OnkjbJ4TwPpgSmjXACCb5J4cJwi880VRe+vWpPDlr8M38/L3slN5uUAeOeWU2jN+4vN0gImCXFGdJmc0wO4Mig==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/utils.js" integrity="sha512-bUcJxlqkiGA3cmoYPuZaLRsyc5ChG9APG4ajom2AXKSlBtOmx4kLV3c8uv/6uSz43FMjI4Q2QI21+D223rT76w==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/utils.min.js" integrity="sha512-JtpGKUjQUqCJmgw3TOr8bkL8QqB8oCbofRU39xgDnRYTfIDvfg0gQs2efeKxBCdwSAP/h3CSqhn87+giWSsxjw==" crossorigin="anonymous"></script>
{% endblock %}

{% block maincontent %}
    <form method="post" onload="verifyNumber()">
        {% csrf_token %}
        <h1>Fill up your details</h1>
        {{ form.name }}<br><br>
        {{ form.email }}<br><br>
        {{ form.contact_number }}<br><br><br>
        
        <h1>Shipping Address</h1>
        {{ form.line1 }}<br><br>
        {{ form.line2 }}<br><br>
        {{ form.city }}<br><br>
        {{ form.province }}
        {{ form.postal_code }}<br><br><br>
        
        <h1>Preferred Delivery Date</h1>
        {{ form.delivery_date }}

        <h1>Mode of Payment</h1>
        {{ form.bank_name }}<br><br>

        <h1>Receive Updates</h1>
        {{ form.notif_sms }} {{ form.notif_sms.label }}<br>
        {{ form.notif_email }} {{ form.notif_email.label }}<br><br><br>
        <button type="submit" class="primary-btn primary-btn-link">Proceed to Payment</button>
    </form>
{% endblock %}

{% block scriptsBody %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/intlTelInput.js" integrity="sha512-lib7WdJvAnfLLBi5AHdN+wUkcWwpu1fmYzyEHQijZq7WedcwBiwdVNbcML2rAtKvwtOIU7thMGB+O9Kpb9g2Cw==" crossorigin="anonymous"></script>
    <script>
        var contactNumberInput = document.querySelector("#id_contact_number");
        var accessKey = '42117e4f8adf2e74c3ce6fdb60e2867f';
        var contactNumber = $("#id_contact_number").val();

        window.intlTelInput(contactNumberInput, {
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.12/js/utils.js",
            initialCountry: "auto",
            separateDialCode: true,
        })

        window.onload = function verifyNumber() {
            console.log(contactNumber);
            if (contactNumber.indexOf(' ') >= 0) {
                contactNumber = contactNumber.trim()
            }

            // $.ajax({
            //     url: 'http://apilayer.net/api/validate?access_key=' + accessKey + '&number=' + contactNumber,   
            //     dataType: 'jsonp',
            //     success:function(json) {
            //         // Access and use your preferred validation result objects
            //         console.log(json);

            //         if (json.valid == true) {
            //             contactNumberInput.css("border", "1px var(--success-main) solid")
            //         } else {
            //             contactNumberInput.css("border", "1px var(--failure-main) solid")
            //         }
            //     },
            //     error:function(json) {
            //         contactNumberInput.css("border", "1px var(--failure-main) solid")
            //     }
            // });

            contactNumberInput.keypress(function() {
                setTimeout(verifyNumber, 500);
            });
        }
    </script>
{% endblock %}