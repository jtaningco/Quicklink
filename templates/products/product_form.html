{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product: Unnamed Product</title>
    <link rel="stylesheet" href="{% static '/css/main.css' %}">
    <link rel="stylesheet" href="{% static '/css/navbar.css' %}">
    <link rel="stylesheet" href="{% static '/css/header.css' %}">
    <link rel="stylesheet" href="{% static '/css/products/product-form.css' %}">

    <!-- NOTY Notification Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.css" integrity="sha512-0p3K0H3S6Q4bEWZ/WmC94Tgit2ular2/n0ESdfEX8l172YyQj8re1Wu9s/HT9T/T2osUw5Gx/6pAZNk3UKbESw==" crossorigin="anonymous">

    <!-- FONT AWESOME KIT -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>

    <!-- JQUERY < 3.0.0 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <form id="product-form" method="POST">
        {% csrf_token %}
        <div class="header-container product-header-container">
            <div class="header-wrapper product-header-wrapper">
                <h1 class="body bold">Unnamed Product</h1>
                <div class="product-header-btns">
                    <a href="{% url 'products:products' %}" style="text-decoration: none; margin-right: 8px;">
                        <button class="secondary-btn subtitle bold">
                            Cancel
                       </button>
                    </a>
                    <button type="submit" id="submitBtn" class="primary-btn disabled subtitle bold">Preview Product</button>
                </div>
            </div>
        </div>

        <main>
            <div class="product-form-container">
                <div class="product-form-wrapper">            
                    <h2 class="bold" style="color: #FF8A00;">Add a new product</h2>
                    
                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Name</p><span style="color: var(--failure-main);">*</span>
                        </div>
                        {{ form.name }}
                    </div>

                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Description</p><span style="color: var(--failure-main);">*</span>
                        </div>
                        {{ form.description }}
                    </div>

                    <div class="product-form-images">
                        {{ imageFormset.management_form }}
                        <img src="https://ik.imagekit.io/ripzjge77zz/Quicklink_App/Merchant/Account_Creation/icons/u_image_XucX2a74QNx.svg" alt="Image Icon" class="upload__icon">
                        <div class="upload__content">
                            <p class="upload__text" id="js-logo-text">Drag your shop's logo here, </p>
                            <p class="upload__text">or <span class="upload__link" id="js-browse-files">browse through your files.</span></p>
                        </div>
                    </div>

                    {{ imageFormset.as_p }}

                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Available Sizes or Servings</p><span style="color: var(--failure-main);">*</span>
                        </div>
                        {{ sizeFormset.management_form }}

                        <!-- The form-TOTAL_FORMS input contains the value of the total number of forms being submitted. If it doesn't match the actual number of forms Django receives when the forms are submitted, an error will be raised. -->
                        <input type="hidden" name="sizeForm-TOTAL_FORMS" value="1" id="sizeForm-TOTAL_SIZES">
                        <input type="hidden" name="sizeForm-MIN_NUM_FORMS" value="1" id="sizeForm-MIN_NUM_SIZES">
                        <input type="hidden" name="sizeForm-MAX_NUM_FORMS" value="10" id="sizeForm-MAX_NUM_SIZES">
                        
                        {% for size in sizeFormset %}    
                        <div class="product-form-formset size-formset">
                            <div class="small-input__container" style="padding-left: 0;">
                                {{ size.size }}
                            </div>
                            <div class="small-input__container" style="padding-right: 0;">
                                {{ size.price_size }}
                            </div>
                            <button type="button" name="id_size-set-0-remove" id="id_size-set-0-remove" class="tertiary-btn delete-size-form"><i class="fa fa-times" aria-hidden="true"></i></button>
                        </div>
                        {% endfor %}
                        <button type="button" id="add-size" class="tertiary-btn btn__add-option bold">Add Option</button>
                    </div>

                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Stocks</p><span style="color: var(--failure-main);">*</span>
                        </div>
                        <div class="product-form-stocks">
                            <div class="radio-select-row">
                                <label class="radio-mobile">
                                    <input type="radio" name="made-to-order" id="made-to-order" checked>
                                    <span class="radio-select-mobile"></span>
                                </label>
                                <label for="made-to-order" class="radio-label subtitle">Made to Order</label>
                            </div>
                            <div class="radio-select-row">
                                <label class="radio-mobile">
                                    <input type="radio" name="stocks-input-select" id="stocks-input-select">
                                    <span class="radio-select-mobile"></span>
                                </label>
                                <label for="stocks-input-select">
                                    {{ form.stock }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Maximum Orders Taken / Day</p><span style="color: var(--failure-main);">*</span>
                        </div>
                        <div class="product-form-stocks">
                            <div class="radio-select-row">
                                <label class="radio-mobile">
                                    <input type="radio" name="no-order-limits" id="no-order-limits" checked> 
                                    <span class="radio-select-mobile"></span>
                                </label>
                                <label for="no-order-limits" class="radio-label subtitle">No Limit</label>
                            </div>
                            <div class="radio-select-row">
                                <label class="radio-mobile">
                                    <input type="radio" name="orders-input-select" id="orders-input-select">
                                    <span class="radio-select-mobile"></span>
                                </label>
                                <label for="orders-input-select">
                                    {{ form.orders }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Possible Add-Ons</p>
                        </div>
                        {{ addonFormset.management_form }}

                        <!-- The form-TOTAL_FORMS input contains the value of the total number of forms being submitted. If it doesn't match the actual number of forms Django receives when the forms are submitted, an error will be raised. -->
                        <input type="hidden" name="addonForm-TOTAL_FORMS" value="1" id="addonForm-TOTAL_SIZES">
                        <input type="hidden" name="addonForm-MIN_NUM_FORMS" value="1" id="addonForm-MIN_NUM_SIZES">
                        <input type="hidden" name="addonForm-MAX_NUM_FORMS" value="10" id="addonForm-MAX_NUM_SIZES">

                        {% for addon in addonFormset %}
                        <div class="product-form-formset addon-formset">
                            <div class="small-input__container" style="padding-left: 0;">
                                {{ addon.addon }}
                            </div>
                            <div class="small-input__container" style="padding-right: 0;">
                                {{ addon.price_addon }}
                            </div>
                            <button type="button" name="id_addon-set-0-remove" id="id_addon-set-0-remove" class="tertiary-btn delete-addon-form"><i class="fa fa-times" aria-hidden="true"></i></button>
                        </div>
                        {% endfor %}
                        <button type="button" id="add-addon" class="tertiary-btn btn__add-option bold">Add Option</button>
                    </div>

                    <div class="product-form-content">
                        <div class="product-form-label">
                            <p class="subtitle bold">Any special instructions, allergens, etc.?</p>
                        </div>
                        {{ form.instructions }}
                    </div>

                    <div id="form-errors" style="display: none;">{{ form.errors.as_json }}</div>
                    
                </div>
            </div>
        </main>
    </form>

    <script src="{% static '/js/addproducts.js' %}"></script>

    <!-- NOTY -->
    <script>
        var errors = $('#form-errors').text();
        var jsonErrors = JSON.parse(errors);

        var errorMessages = [];

        for (var k in jsonErrors) {
            for (var i in Object.keys(jsonErrors[k])) {
                errorMessages.push([jsonErrors[k][i]['message']]);
            }
        }

        for (i = 0; i <= Object.keys(errorMessages).length; i++) {
            if (errorMessages[String(i)] != undefined) {
                new Noty({
                    type: 'error',
                    theme: 'bootstrap-v4',
                    text: errorMessages[String(i)],
                    layout: "topRight",
                    timeout: 5000,
                    progressBar: true,
                }).show();
            }
        }
    </script>
</body>
</html>